# CScan 项目命令参数和功能说明

## 一、Worker 节点参数

Worker 是 CScan 的扫描工作节点，负责执行实际的扫描任务。

### 1.1 命令行参数

- `-s <API服务器地址>`：指定API服务器地址（默认值：`http://localhost:8888`）
  - 示例：`-s http://192.168.1.100:8888`
  - 环境变量：`CSCAN_SERVER`

- `-n <Worker名称>`：指定Worker节点名称（默认值：主机名-进程ID）
  - 示例：`-n worker-node-01`
  - 环境变量：`CSCAN_NAME`

- `-c <并发数>`：设置扫描并发数（默认值：5）
  - 示例：`-c 10`
  - 环境变量：`CSCAN_CONCURRENCY`

- `-k <安装密钥>`：指定安装密钥，用于Worker注册验证（必须参数）
  - 示例：`-k abcdefg1234567`
  - 环境变量：`CSCAN_KEY`

### 1.2 使用示例

```bash
# 基本启动命令
go run cmd/worker/main.go -k <install_key> -s http://localhost:8888

# 指定名称和并发数
go run cmd/worker/main.go -k <install_key> -s http://192.168.1.100:8888 -n worker-01 -c 10

# 使用环境变量
export CSCAN_KEY=your_install_key
export CSCAN_SERVER=http://192.168.1.100:8888
export CSCAN_NAME=worker-01
export CSCAN_CONCURRENCY=8
go run cmd/worker/main.go
```

## 二、API 服务配置

API服务是CScan的中央管理节点，提供REST API接口。

### 2.1 配置文件参数 (cscan.yaml)

- `Name`: 服务名称 (默认: cscan-api)
- `Host`: 监听地址 (默认: 0.0.0.0)
- `Port`: 监听端口 (默认: 8888)
- `MaxBytes`: 最大请求字节数 (默认: 104857600 = 100MB)
- `Timeout`: 请求超时时间 (默认: 300000ms = 5分钟)

#### 日志配置 (Log)
- `Level`: 日志级别 (默认: error)
- `Stat`: 是否启用统计 (默认: false)
- `Mode`: 日志模式 (默认: console)
- `Encoding`: 日志编码 (默认: plain)
- `TimeFormat`: 时间格式 (默认: 2006-01-02 15:04:05)

#### 认证配置 (Auth)
- `AccessSecret`: JWT访问密钥
- `AccessExpire`: JWT过期时间 (默认: 86400秒 = 1天)

#### 数据库配置 (Mongo)
- `Uri`: MongoDB连接地址 (默认: mongodb://localhost:27017)
- `DbName`: 数据库名称 (默认: cscan)

#### Redis配置 (Redis)
- `Host`: Redis主机地址 (默认: localhost:6379)
- `Pass`: Redis密码 (默认: 空)
- `Type`: Redis类型 (默认: node)

#### RPC配置 (TaskRpc)
- `Endpoints`: RPC服务地址列表 (默认: [127.0.0.1:9000])
- `Timeout`: RPC调用超时时间 (默认: 30000ms)

## 三、RPC 服务配置

RPC服务处理内部服务通信和任务调度。

### 3.1 配置文件参数 (task.yaml)

- `Name`: 服务名称 (默认: task.rpc)
- `ListenOn`: 监听地址和端口 (默认: 0.0.0.0:9000)
- `MaxRecvMsgSize`: 最大接收消息大小 (默认: 104857600 = 100MB)
- `MaxSendMsgSize`: 最大发送消息大小 (默认: 104857600 = 100MB)

#### 日志配置 (Log)
- `Level`: 日志级别 (默认: error)
- `Stat`: 是否启用统计 (默认: false)
- `Mode`: 日志模式 (默认: console)
- `Encoding`: 日志编码 (默认: plain)
- `TimeFormat`: 时间格式 (默认: 2006-01-02 15:04:05)

#### 数据库配置 (Mongo)
- `Uri`: MongoDB连接地址 (默认: mongodb://localhost:27017)
- `DbName`: 数据库名称 (默认: cscan)

#### Redis配置 (RedisConf)
- `Host`: Redis主机地址 (默认: localhost:6379)
- `Pass`: Redis密码 (默认: 空)
- `Type`: Redis类型 (默认: node)

## 四、启动脚本参数

### 4.1 一键管理脚本 (cscan.sh)

CScan提供了便捷的一键管理脚本，支持安装、升级、卸载等功能。

使用方式：
```bash
# 给予执行权限
chmod +x cscan.sh

# 执行脚本
./cscan.sh
```

脚本功能：
- 安装 CScan 服务
- 升级 CScan 服务
- 卸载 CScan 服务
- 检查版本信息
- 管理服务状态

### 4.2 Windows启动脚本 (cscan.bat)

Windows环境下使用cscan.bat进行管理。

## 五、项目核心功能

### 5.1 扫描功能

- **资产发现**：基于 Naabu/Masscan/Nmap 的高速端口扫描和服务识别
- **子域名枚举**：结合 Subfinder（被动）与 KSubdomain（字典爆破）
- **指纹识别**：集成 Httpx + Wappalyzer + 自定义引擎，支持超3万条规则
- **URL 发现**：通过 Urlfinder 实现路径爬取
- **漏洞检测**：使用 Nuclei SDK 执行 POC 扫描，支持自定义 POC
- **Web 截图**：利用 Chromedp 和 HTTPX 进行页面快照
- **在线数据源聚合**：对接 FOFA / Hunter / Quake API

### 5.2 管理功能

- **分布式架构**：支持横向扩展 Worker 节点
- **多工作空间**：实现组织级资产隔离
- **报告导出**：生成结构化扫描报告
- **审计日志**：记录操作行为与系统事件
- **任务调度**：智能负载均衡和任务分配

### 5.3 安全机制

- **JWT 认证**：用于用户接口鉴权
- **安装密钥认证**：Worker 注册时使用 Install Key 鉴权
- **输入参数校验**：防止命令注入风险
- **权限控制**：基于角色的权限管理

## 六、部署方式

### 6.1 本地开发部署

```bash
# 启动依赖
docker-compose -f docker-compose.dev.yaml up -d

# 启动 RPC 服务
go run rpc/task/task.go -f rpc/task/etc/task.yaml

# 启动 API 服务
go run api/cscan.go -f api/etc/cscan.yaml

# 启动前端
cd web && npm install && npm run dev

# 启动 Worker（需获取 install_key）
go run cmd/worker/main.go -k <install_key> -s http://localhost:8888
```

### 6.2 生产环境部署

```bash
# Linux 快速启动
chmod +x cscan.sh && ./cscan.sh

# Windows 快速启动
.\cscan.bat

# Worker 部署（Linux）
./cscan-worker -k <install_key> -s http://<api_host>:8888

# Worker 部署（Windows）
cscan-worker.exe -k <install_key> -s http://<api_host>:8888
```

访问地址: `https://<ip>:3443`，默认账号 `admin / 123456`