# SweetBabyScan 项目分析报告

## 一、项目概述

SweetBabyScan（简称SbScan）是一个轻量级的内网资产探测与漏洞扫描工具，集成了Xray与Nuclei的Poc。该项目主要用于内网安全评估，支持多种网络协议和服务的自动化检测与弱口令爆破。

## 二、项目目录结构与功能说明

### 2.1 顶级目录结构

- config: 配置管理目录，包含探针配置、POC路径等
- core: 核心功能实现目录，包括协议实现、插件等
- initializes: 初始化组件目录，如HTTP客户端、截图功能等
- models: 数据模型定义目录
- test: 测试代码目录
- utils: 通用工具函数目录
- main.go: 主程序入口
- readme.md: 项目说明文档
- build.sh: 构建脚本

### 2.2 核心子目录详细说明

#### 2.2.1 config 目录
- probe: 探针配置，包含服务指纹识别规则
- pocs: POCS目录，包含Xray的POC规则
- ua.json: User-Agent配置文件
- config.go: 配置常量定义

#### 2.2.2 core 目录
- grdp: RDP协议实现，用于RDP弱口令爆破
- plugins: 各种扫描插件
  - plugin_port_forward: 端口转发插件
  - plugin_port_map: 内网穿透插件
  - plugin_scan_cms1: CMS识别插件1
  - plugin_scan_cms2: CMS识别插件2
  - plugin_scan_host: 主机存活检测插件
  - plugin_scan_ms17010: MS17-010漏洞检测插件
  - plugin_scan_net: 网络检测插件
  - plugin_scan_net_bios: NetBIOS检测插件
  - plugin_scan_poc_nuclei: Nuclei POC检测插件
  - plugin_scan_poc_xray: Xray POC检测插件
  - plugin_scan_port: 端口扫描插件
  - plugin_scan_site: 网站扫描插件
  - plugin_scan_smb_ghost: SMBGhost漏洞检测插件
  - plugin_scan_weak: 弱口令扫描插件
  - plugin_sock5: SOCK5代理插件
- tasks: 扫描任务管理
  - task_scan_host_domain: 域名主机扫描任务
  - task_scan_host_ip: IP主机扫描任务
  - task_scan_poc_nuclei: Nuclei POC扫描任务
  - task_scan_poc_xray: Xray POC扫描任务
  - task_scan_port_domain: 域名端口扫描任务
  - task_scan_port_ip: IP端口扫描任务
  - task_scan_site: 网站扫描任务
  - task_scan_vul: 漏洞扫描任务
  - task_scan_weak: 弱口令扫描任务

#### 2.2.3 initializes 目录
- initialize_cms: CMS识别初始化
- initialize_http_client: HTTP客户端初始化
- initialize_screenshot: 截图功能初始化
- initialize.go: 统一初始化入口

#### 2.2.4 utils 目录
- util_array.go: 数组工具函数
- util_file.go: 文件操作工具函数
- util_ip_range.go: IP范围处理工具函数
- util_msg.go: 消息处理工具函数
- util_multi_task.go: 多任务并发处理工具
- util_parse_ip.go: IP解析工具函数
- util_parse_port.go: 端口解析工具函数
- util_save_excel.go: Excel保存工具函数
- util_save_text.go: 文本保存工具函数
- util_table.go: 表格显示工具函数
- util_yield.go: 生成器工具函数

## 三、项目运行原理和逻辑

### 3.1 主程序流程

1. **初始化阶段** (init函数)
   - 创建`./static`目录
   - 执行所有初始化组件(InitAll)

2. **参数解析阶段**
   - 使用goflags库解析命令行参数
   - 包括目标主机、端口、协议、并发数、超时时间等配置

3. **特殊功能分支**
   - 列出Nuclei POC列表
   - 列出Xray POC列表
   - 端口转发
   - 内网穿透
   - SOCK5代理

4. **主扫描流程**

### 3.2 扫描流程详解

#### 3.2.1 主机存活检测
- 支持ICMP和PING两种方式
- 对IP和域名分别进行检测
- 使用多协程并发提高效率

#### 3.2.2 端口服务扫描
- 支持TCP/UDP协议扫描
- 内置多种端口组合策略（tiny、web、normal、database、cafè、iot、all）
- 使用探针指纹识别技术确定服务类型

#### 3.2.3 网站内容爬虫
- 自动抓取网站内容
- 识别CMS类型
- 支持网站截图功能

#### 3.2.4 POC漏洞探测
- 集成Nuclei和Xray的POC规则
- 支持按漏洞等级过滤（critical、high、medium、low、info、unknown）
- 可自定义超时时间和并发数

#### 3.2.5 高危漏洞探测
- 检测MS17010、SMBGhost等高危系统漏洞

#### 3.2.6 弱口令爆破
- 支持多种协议的弱口令爆破（FTP/SMB/SSH/RDP/Redis/MongoDB/MySQL等）
- 可自定义字典和并发数
- 提供弱口令生成器功能

### 3.3 技术架构特点

#### 3.3.1 插件化架构
- 各个功能模块以插件形式实现
- 易于扩展和维护

#### 3.3.2 任务驱动模型
- 通过tasks包管理不同类型的扫描任务
- 每个任务都有标准的接口和生命周期

#### 3.3.3 并发控制机制
- 使用多协程并发提高扫描效率
- 可调节各项任务的并发数
- 有完善的超时控制机制

#### 3.3.4 结果处理
- 支持将扫描结果导出为Excel和TXT文件
- 支持网站截图保存到静态目录

### 3.4 关键技术实现

#### 3.4.1 探针指纹识别
项目使用了自定义的探针指纹库来识别服务类型，通过发送特定的数据包并分析响应来判断服务类型。

#### 3.4.2 多协议支持
- 支持ICMP/PING进行主机存活检测
- 支持TCP/UDP端口扫描
- 支持HTTP/HTTPS网站扫描
- 支持RDP协议的弱口令爆破

#### 3.4.3 RDP协议实现
项目包含了完整的RDP协议实现，用于检测和爆破RDP弱口令。

#### 3.4.4 内网穿透机制
实现了基于密钥的内网穿透功能，支持客户端和服务端模式。

### 3.5 安全考虑
- 所有扫描和爆破操作需要用户授权
- 高并发扫描可能导致网络拥堵，需要合理设置并发数
- 弱口令爆破仅应在授权范围内使用

## 四、总结

SweetBabyScan是一个功能全面的内网安全扫描工具，具有以下优势：

1. 功能丰富：包含主机发现、端口扫描、漏洞检测、弱口令爆破等多种功能
2. 扩展性强：采用插件化架构，易于添加新功能
3. 性能良好：使用多协程并发，支持高并发扫描
4. 集成度高：整合了多种安全工具的POC规则
5. 输出多样：支持Excel、TXT等多种结果输出格式

该工具适合渗透测试人员和网络安全工程师在授权范围内使用，进行内网安全评估和漏洞检测。