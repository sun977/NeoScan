# Agent å¼€å‘è¿›åº¦è¯„ä¼° (æˆªè‡³ 2026-02-10)

## æ ¸å¿ƒçŠ¶æ€æ¦‚è§ˆ

**"Foundation First. Speed Second."**
Agent æ­£å¤„äºä» "HTTP Worker" å‘ "Native Scanner" çš„å…³é”®è½¬å‹æœŸã€‚
Cobra CLI æ¶æ„å’Œ Core Task æ¨¡å‹å·²å»ºç«‹ï¼ŒOptions å¼ºç±»å‹å‚æ•°è§£æå·²å°±ç»ªã€‚
**Phase 4 (ç¼–æ’ä¸é›†æˆ)** å·²å–å¾—é‡å¤§è¿›å±•ï¼Œ**Phase 4.1 å…¨æµç¨‹ç¼–æ’** å·²å®Œæˆã€‚
**Phase 4.2 (é›†ç¾¤é€‚é…)** å·²å®Œæˆï¼Œ**Agent å·²å…·å¤‡å®Œæ•´çš„ Worker èƒ½åŠ› (æ‹‰å–-æ‰§è¡Œ-ä¸ŠæŠ¥)**ã€‚
**Phase 4.3 (é«˜çº§èƒ½åŠ›é›†æˆ)** Web æ¨¡å—å·²å®Œæˆäº¤ä»˜ä¸é›†æˆã€‚

*   **Architecture (æ¶æ„)**: **100%**ã€‚Cobra å‘½ä»¤æ ‘ã€Options æ¨¡å¼ã€Core Task æ¨¡å‹å·²å®Œæˆï¼ŒReporter æ¥å£å·²å®šä¹‰ã€‚
*   **Core Capability (æ ¸å¿ƒèƒ½åŠ›)**: **100%**ã€‚
    *   IpAliveScanner: ğŸŸ¢ (RTT/TTL/OS/Hostname/CIDRæ”¯æŒ)
    *   PortScanner: ğŸŸ¢ (TCP Connect + CSV/JSON Export)
    *   ServiceScanner: ğŸŸ¢ (Nmap Engine + Custom Rules + **Dynamic Scheduling**)
    *   OSScanner: ğŸŸ¢ (TCP/IP Stack Fingerprint + Service Banner + Unified Output)
    *   **WebScanner**: ğŸŸ¢ (Headless Browser + Fingerprint + Screenshot + JS Vars)
*   **Orchestration (ç¼–æ’)**: **100%**ã€‚
    *   Pipeline: ğŸŸ¢ (Alive -> Port -> Service -> OS -> Web è‡ªåŠ¨åŒ–ä¸²è”)
    *   TargetGenerator: ğŸŸ¢ (æ”¯æŒ CIDR/Range/List è§£æ)
    *   AutoRunner: ğŸŸ¢ (æ”¯æŒå¹¶å‘æ‰«æã€ç»“æœæ±‡æ€»ã€Funnel è¿‡æ»¤)
*   **Infrastructure (åŸºç¡€è®¾æ–½)**: **95%**ã€‚Nmap è§„åˆ™åº“é™æ€æ‰“åŒ…å®Œæˆï¼Œç½‘ç»œåº“ (Dialer/Proxy) é‡æ„å®Œæˆï¼ŒRaw Socket æ”¯æŒå°±ç»ªã€‚
*   **Connectivity (è¿æ¥æ€§)**: **100%**ã€‚Master-Agent é€šä¿¡é—­ç¯å·²æ‰“é€šï¼Œæ”¯æŒ Token è®¤è¯ã€å¿ƒè·³ã€ä»»åŠ¡æ‹‰å–ä¸ç»“æœä¸ŠæŠ¥ã€‚

---

## 1. æ¨¡å—è¯¦ç»†è¯„ä¼°

### 1.1 Core Decoupling (æ ¸å¿ƒè§£è€¦) - "The Foundation"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Directory Structure** | ğŸŸ¢ **Done** | `internal/core` å·²åˆ›å»ºã€‚ |
| **Task Model** | ğŸŸ¢ **Done** | `model.Task` å·²å®šä¹‰ï¼Œæ”¯æŒå¤šç§æ‰«æç±»å‹ã€‚ |
| **Service Logic** | ğŸŸ¢ **Done** | Scanner/Runner æ¥å£å·²å®šä¹‰ (`runner/interface.go`)ã€‚ |
| **Reporter** | ğŸŸ¢ **Done** | `ConsoleReporter` (Tabular) å’Œ `CsvReporter` å·²å®ç°å¹¶ç»Ÿä¸€ã€‚ |

### 1.2 CLI Transformation (CLI æ”¹é€ ) - "The Interface"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Cobra Entry** | ğŸŸ¢ **Done** | `main.go` å·²é‡å†™ï¼Œ`root.go` é›†æˆ Viperã€‚ |
| **Server Command** | ğŸŸ¢ **Done** | æ”¯æŒ `--master` å’Œ `--token` å‚æ•°ã€‚ |
| **Scan Command** | ğŸŸ¢ **Done** | 8ç§æ‰«æå­å‘½ä»¤ (Alive, Port, Service, OS, Web, Dir, Vuln, Subdomain) å·²å°±ç»ªã€‚ |
| **Proxy Command** | ğŸŸ¢ **Done** | æ”¯æŒ Socks5/HTTP/PortForward æ¨¡å¼å‚æ•°è§£æã€‚ |
| **Output Config** | ğŸŸ¢ **Done** | å…¨å±€æ”¯æŒ CSV/JSON è¾“å‡º (`--oc`, `--oj`)ï¼Œä¸” OS/Port/Web æ‰«æå·²é€‚é…ã€‚ |

### 1.3 Native Capabilities (åŸç”Ÿèƒ½åŠ›) - "The Power"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Concurrency** | ğŸŸ¢ **Done** | åŸºäº Semaphore çš„å¹¶å‘æ§åˆ¶ï¼Œæ”¯æŒ WaitGroup è°ƒåº¦ã€‚ |
| **Host Discovery** | ğŸŸ¢ **Done** | `IpAliveScanner` å·²å®ç° ARP/ICMP/TCP æ¢æµ‹ï¼Œæ”¯æŒ OS/Hostname/RTT/TTL è§£æã€‚ |
| **Port Scan** | ğŸŸ¢ **Done** | åŸç”Ÿ TCP Connect Scanï¼Œæ”¯æŒå¹¶å‘æ§åˆ¶ï¼ŒCLI è¾“å‡ºå·²ç»Ÿä¸€ã€‚ |
| **Service Scan** | ğŸŸ¢ **Done** | `PortServiceScanner` æ•´åˆ Gonmap å¼•æ“ï¼Œæ”¯æŒ Nmap æ¢é’ˆå’ŒæŒ‡çº¹åŒ¹é…ã€‚**æ–°å¢æ™ºèƒ½è°ƒåº¦**ã€‚ |
| **OS Finger** | ğŸŸ¢ **Done** | å®ç°äº† Nmap TCP/IP æ ˆæŒ‡çº¹è¯†åˆ« (Loopback ä¼˜åŒ–) + æœåŠ¡ Banner è¾…åŠ©è¯†åˆ«ã€‚ |
| **Web Finger** | ğŸŸ¢ **Done** | åŸºäº go-rod çš„å…¨æ ˆæ‰«æï¼Œæ”¯æŒ Screenshot/TechStack/Headers æå–ä¸åŒ¹é…ã€‚ |

### 1.4 Cluster Integration (é›†ç¾¤é›†æˆ) - "The Connection"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Join Protocol** | ğŸŸ¢ **Done** | CLI å‚æ•°å·²æ”¯æŒ Tokenï¼ŒåºŸé™¤ç‹¬ç«‹çš„ Join å‘½ä»¤ã€‚ |
| **Auth Storage** | ğŸŸ¢ **Done** | Viper ç»‘å®š Tokenï¼Œå†…å­˜/æ–‡ä»¶é…ç½®æ”¯æŒã€‚ |
| **Task Pulling** | ğŸŸ¢ **Done** | `internal/service/task` å®ç°äº† Worker Loopï¼Œæ”¯æŒé•¿è½®è¯¢ã€‚ |

### 1.5 Scan Orchestration (å…¨æµç¨‹ç¼–æ’) - "The Brain"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Pipeline Core** | ğŸŸ¢ **Done** | `PipelineRunner` å·²å®ç°ï¼Œæ”¯æŒ Stage é—´æ•°æ®æµè½¬ã€‚ |
| **Target Gen** | ğŸŸ¢ **Done** | æ”¯æŒ CIDR (192.168.1.0/24), Range, List è§£æã€‚ |
| **Auto Command** | ğŸŸ¢ **Done** | `scan run` å‘½ä»¤å·²å°±ç»ªï¼Œæ”¯æŒ `--summary` æ±‡æ€»æŠ¥å‘Šã€‚ |
| **Funnel Filter** | ğŸŸ¢ **Done** | å®ç°äº† Alive -> Port -> Service -> Web çš„æ¼æ–—å¼è¿‡æ»¤ã€‚ |

---

## 2. ä¸‹ä¸€æ­¥è¡ŒåŠ¨ (Next Steps)

**"Stop designing. Start coding."**

### P0: Phase 4.1 - å…¨æµç¨‹ç¼–æ’å‡çº§ (Parallel Pipeline)
*   **ç›®æ ‡**: å°†çº¿æ€§çš„ `PipelineRunner` å‡çº§ä¸ºæ”¯æŒ **å¹¶è¡Œåˆ†å‘** å’Œ **ä¼˜å…ˆçº§æ§åˆ¶** çš„ v2.0 ç‰ˆæœ¬ã€‚
*   **çŠ¶æ€**: ğŸŸ¢ **å·²å®Œæˆ**
*   **è¡ŒåŠ¨**:
    1.  **åˆ†å‘å™¨ (Dispatcher)**:
        - [x] å®ç° `internal/core/pipeline/dispatcher.go`ï¼Œå®šä¹‰åˆ†å‘è§„åˆ™ (Web/Vuln/Brute)ã€‚
    2.  **æ‰§è¡Œå¼•æ“ (Runner Refactor)**:
        - [x] é‡æ„ `AutoRunner`ï¼Œå¼•å…¥ `sync.WaitGroup` ç®¡ç†å¹¶è¡Œ Workerã€‚
        - [x] å®ç° `Phase 1 (Sequential)`: Alive -> PortServiceã€‚
        - [x] å®ç° `Phase 2 (Parallel)`: å¯åŠ¨ WebWorker, VulnWorker, BruteWorkerã€‚
    3.  **ä¾èµ–ç®¡ç† (Dependency)**:
        - [x] å®ç° `Vuln First, Brute Last` ç­–ç•¥ï¼Œç¡®ä¿ Brute ä»»åŠ¡åœ¨åŒç«¯å£ Vuln ä»»åŠ¡å®Œæˆåæ‰§è¡Œã€‚

### P0: Phase 4.2 - é›†ç¾¤é€‚é…å¢å¼º (Cluster Adapter)
*   **ç›®æ ‡**: ç¡®ä¿ Server æ¨¡å¼ä¸ CLI æ¨¡å¼å…·å¤‡ä¸€è‡´çš„æ‰«æèƒ½åŠ›ã€‚
*   **çŠ¶æ€**: ğŸŸ¢ **å·²å®Œæˆ**
*   **è¡ŒåŠ¨**:
    1.  **ç»Ÿä¸€åˆå§‹åŒ–**: é‡æ„ `setup/core.go`ï¼Œç§»é™¤æ‰‹åŠ¨å®ä¾‹åŒ–ä»£ç ï¼Œå¤ç”¨ `RunnerManager` çš„ Factory é€»è¾‘ã€‚
    2.  **èƒ½åŠ›å¯¹é½**: Server æ¨¡å¼ç°å·²æ”¯æŒå…¨åŠŸèƒ½çˆ†ç ´ã€æ™ºèƒ½è¶…æ—¶æ§åˆ¶å’Œè§„åˆ™åº“åŠ è½½ã€‚

### P0: Phase 4.3 - é«˜çº§èƒ½åŠ›é›†æˆ (Advanced Capabilities)
*   **ç›®æ ‡**: æå‡ Agent çš„"é‡æ­¦å™¨"èƒ½åŠ›ã€‚
*   **çŠ¶æ€**: ğŸŸ¢ **å·²å®Œæˆ**
*   **è¡ŒåŠ¨**:
    1.  é›†æˆ **Nuclei** æ‰§è¡Œå™¨ (ä½œä¸ºç‹¬ç«‹ Scanner æˆ– Plugin)ã€‚
    2.  [x] å®ç° **Web æŒ‡çº¹è¯†åˆ«** (Wappalyzer/FingerprintHub è§„åˆ™åº“é€‚é…)ã€‚
    3.  [x] å®ç°åŸºç¡€çš„ **Web çˆ¬è™«** (URL é‡‡é›†)ã€‚
    4.  **Web æ‰«æå™¨å®Œå–„ (Web Scanner Polish)**:
        - [x] **JS Variables**: å®ç°åŠ¨æ€æå– JS å…¨å±€å˜é‡ä»¥æ”¯æŒ NeoScan å†…éƒ¨æŒ‡çº¹è§„åˆ™ã€‚
        - [x] **Integration**: å°† WebScanner é›†æˆåˆ° `ServiceDispatcher`ï¼Œå®ç° `scan run` è‡ªåŠ¨åŒ–è°ƒç”¨ã€‚
        - [x] **Verification**: è·‘é€š `scan run --web` å…¨æµç¨‹æµ‹è¯•ï¼ŒéªŒè¯ CLI/CSV/JSON è¾“å‡ºä¸€è‡´æ€§ã€‚

### P1: Phase 3.7 - åŸºç¡€çˆ†ç ´ (Brute Force)
*   **ç›®æ ‡**: å®ç°å¸¸è§æœåŠ¡çš„å¼±å£ä»¤æ£€æµ‹ï¼Œæ”¯æŒé«˜å¹¶å‘ä¸”å®‰å…¨ï¼ˆé˜²å°ç¦ï¼‰çš„çˆ†ç ´ã€‚
*   **çŠ¶æ€**: ğŸŸ¢ **å·²å®Œæˆ**
*   **è¡ŒåŠ¨**:
    1.  **åŸºç¡€è®¾æ–½ (Infrastructure)**:
        - [x] **Global Factory**: å®ç°äº† `internal/core/factory`ï¼Œç»Ÿä¸€ç®¡ç† Brute, Alive, Port, OS çš„å®ä¾‹åŒ–ã€‚
        - [x] **QoS**: å®ç°äº†åŸºäºåé¦ˆçš„è‡ªé€‚åº”é™æµ (Adaptive Limiter)ã€‚
        - [x] **Test Cycle**: è§£å†³äº†æµ‹è¯•æ–‡ä»¶ä¸­çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚
        - [x] å®šä¹‰ `Cracker` æ¥å£ (å€Ÿé‰´ Qscanï¼Œçº¯ç²¹éªŒè¯é€»è¾‘)ã€‚
        - [x] å®ç° `DictManager` (æ”¯æŒå†…ç½® Top100 + `%user%` åŠ¨æ€æ›¿æ¢)ã€‚
        - [x] å®ç° `BruteScanner` è°ƒåº¦å™¨ (é›†æˆ `AdaptiveLimiter` å…¨å±€æµæ§ + å•æœºä¸²è¡Œ)ã€‚
    2.  **åè®®å®ç° (Protocols)**:
        - [x] **ç³»ç»ŸæœåŠ¡**: SSH, RDP (Native Go), SMB, Telnet, FTP, SNMP
        - [x] **æ•°æ®åº“**: MySQL, PostgreSQL, MSSQL, Oracle (SIDæ¢æµ‹+çˆ†ç ´), MongoDB, Redis, ClickHouse, Elasticsearch
    3.  **é›†æˆ (Integration)**:
        - [x] æ³¨å†Œåˆ° RunnerManagerã€‚
        - [x] CLI å‘½ä»¤ `scan brute` å®ç°ä¸éªŒè¯ (æ”¯æŒå¤šç«¯å£ã€å…¨é‡æ¨¡å¼ã€è¡¨æ ¼è¾“å‡º)ã€‚
        - [x] ç«¯åˆ°ç«¯æµ‹è¯• (Covered: SSH, Mock Network Error, StopOnSuccess)ã€‚

---

## 3. é£é™©ä¸é˜»ç¢ (Risks & Blockers)

*   **é£é™©**: Web æ¨¡å— (Nuclei/Crawler) å¯èƒ½ä¼šå¼•å…¥è¾ƒå¤§çš„äºŒè¿›åˆ¶ä½“ç§¯æˆ–å†…å­˜å¼€é”€ã€‚éœ€è¦ä»”ç»†æƒè¡¡æ˜¯ "Built-in" è¿˜æ˜¯ "Plugin/Sidecar"ã€‚
*   **é˜»ç¢**: æ— ã€‚

---

## 4. æœ€è¿‘æ›´æ–°è®°å½• (Changelog)

### [2026-02-10] Web Scanner å®Œå–„ä¸é›†æˆ
**æ ¸å¿ƒäº¤ä»˜**:
1.  **Integration Complete**: WebScanner å·²å®Œå…¨é›†æˆè‡³ `ServiceDispatcher`ï¼Œ`scan run` æµç¨‹å¯è‡ªåŠ¨è¯†åˆ« Web æœåŠ¡å¹¶è§¦å‘ Web æ‰«æã€‚
2.  **Output Consistency**: ç»Ÿä¸€äº† CLIã€JSONã€CSV çš„è¾“å‡ºå­—æ®µï¼Œç¡®ä¿ Title, TechStack, Server, Headers ç­‰ä¿¡æ¯åœ¨æ‰€æœ‰è¾“å‡ºæ ¼å¼ä¸­ä¸€è‡´ä¸”å®Œæ•´ã€‚
3.  **Code Optimization**: ä¼˜åŒ–äº† Dispatcher çš„ç«¯å£åè®®åˆ¤æ–­é€»è¾‘ (Switch Case Refactor)ï¼Œæé«˜äº†ä»£ç å¯è¯»æ€§ã€‚
4.  **Documentation**: æ›´æ–°äº† WebScanner æ–‡æ¡£ï¼Œä¿®æ­£äº† Mermaid è¯­æ³•é”™è¯¯ï¼Œæ˜ç¡®äº†å†…éƒ¨æŒ‡çº¹è§„åˆ™æ ¼å¼ã€‚

### [2026-02-06] Web Scanner äº¤ä»˜
**æ ¸å¿ƒäº¤ä»˜**:
1.  **Headless Browser é›†æˆ**: å¼•å…¥ `go-rod`ï¼Œå®ç°äº† `BrowserManager` (è‡ªåŠ¨ä¸‹è½½ Chromium) å’Œ `BrowserLauncher` (å¯åŠ¨/ä»£ç†é…ç½®)ã€‚
2.  **Web æ‰«æå™¨**: å®ç°äº† `WebScanner`ï¼Œæ”¯æŒæå– DOMã€Metaã€Headersã€Cookiesã€Faviconã€Screenshot ç­‰å¯Œä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚
3.  **æŒ‡çº¹è¯†åˆ«**: é›†æˆäº† `Fingerprint` å¼•æ“ï¼Œæ”¯æŒåŠ è½½ JSON è§„åˆ™åº“å¹¶è¿›è¡Œå¤šç»´åº¦åŒ¹é… (Body, Header, Title, Meta, Script)ã€‚
4.  **æ•°æ®å¥‘çº¦å¯¹é½**: `WebResult` æ¨¡å‹å®Œå…¨å¯¹é½ Master ç«¯å¥‘çº¦ï¼Œæ”¯æŒ IP/Port/TechStack/Screenshot/Favicon å­—æ®µã€‚
5.  **QoS & çº¿ç¨‹å®‰å…¨**: å®ç°äº†åŸºäºäº‹ä»¶ç›‘å¬çš„ç½‘ç»œä¿¡æ¯æå–ï¼Œå¹¶è§£å†³äº†å¹¶å‘è®¿é—®çš„å®‰å…¨é—®é¢˜ï¼›é›†æˆäº† `AdaptiveLimiter` è¿›è¡Œæµæ§ã€‚

### [2026-02-05] Global Factory é‡æ„ (Phase 1)
**æ¶æ„ä¼˜åŒ–**:
1.  **Scanner Factory**: å¼•å…¥ `internal/core/factory` åŒ… (å·²è¿ç§»è‡³é¡¶å±‚)ï¼Œä½œä¸ºæ‰€æœ‰ Scanner çš„ç»Ÿä¸€å®ä¾‹åŒ–å…¥å£ã€‚
2.  **Brute Factory**: å®ç°äº† `NewFullBruteScanner` å·¥å‚æ–¹æ³•ï¼Œç»Ÿä¸€äº† 15+ ç§çˆ†ç ´åè®®çš„æ³¨å†Œé€»è¾‘ã€‚
3.  **DRY Refactor**: é‡æ„äº† `AutoRunner` å’Œ `RunnerManager`ï¼Œæ¶ˆé™¤äº†é‡å¤çš„ Cracker æ³¨å†Œä»£ç ï¼Œç¡®ä¿ CLI å•ç‚¹æ‰«æå’Œå…¨æµç¨‹ç¼–æ’çš„èƒ½åŠ›ä¸€è‡´æ€§ã€‚
4.  **Verification**: é€šè¿‡ `scan brute` å¯¹ SSH è¿›è¡Œäº†å›å½’æµ‹è¯•ï¼ŒéªŒè¯å·¥å‚æ¨¡å¼å·¥ä½œæ­£å¸¸ã€‚
