# Agent å¼€å‘è¿›åº¦è¯„ä¼° (æˆªè‡³ 2026-01-21)

## æ ¸å¿ƒçŠ¶æ€æ¦‚è§ˆ

**"Foundation First. Speed Second."**
Agent æ­£å¤„äºä» "HTTP Worker" å‘ "Native Scanner" çš„å…³é”®è½¬å‹æœŸã€‚
ç›®å‰çš„æ¶æ„é‡æ„è“å›¾å·²ç¡®è®¤ï¼Œç†è®ºåŸºç¡€å·²å¤¯å®ï¼ˆCobra, Native Core, Semaphore Concurrency, Token Authï¼‰ã€‚
ç°åœ¨æ˜¯**æ‰§è¡Œé˜¶æ®µ (Execution Phase)**ã€‚

*   **Architecture (æ¶æ„)**: **10%**ã€‚é‡æ„è®¾è®¡å·²å®Œæˆï¼Œæ–‡æ¡£å·²å†»ç»“ã€‚ä»£ç è¿ç§»å°šæœªå¼€å§‹ã€‚
*   **Core Capability (æ ¸å¿ƒèƒ½åŠ›)**: **5%**ã€‚åŸç”Ÿæ‰«æèƒ½åŠ›ï¼ˆNative Scanï¼‰ç­‰å¾…å®ç°ï¼Œç›®å‰ä»ä¸¥é‡ä¾èµ–å¤–éƒ¨å·¥å…·ã€‚
*   **Infrastructure (åŸºç¡€è®¾æ–½)**: **20%**ã€‚Docker å’ŒåŸºç¡€ç›®å½•ç»“æ„å·²å°±ç»ªï¼Œä½†éœ€è¦é€‚åº”æ–°çš„ Cobra æ¶æ„ã€‚
*   **Connectivity (è¿æ¥æ€§)**: **30%**ã€‚HTTP Server ä»£ç å­˜åœ¨ï¼Œä½†éœ€è¦é‡æ„ä¸º Cluster æ¨¡å¼çš„ä¸“ç”¨å­å‘½ä»¤ã€‚

---

## 1. æ¨¡å—è¯¦ç»†è¯„ä¼°

### 1.1 Core Decoupling (æ ¸å¿ƒè§£è€¦) - "The Foundation"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Directory Structure** | ğŸ”´ **Pending** | `internal/core` å°šæœªåˆ›å»ºã€‚ |
| **Task Model** | ğŸ”´ **Pending** | é€šç”¨ `Task/TaskResult` ç»“æ„ä½“éœ€å®šä¹‰ã€‚ |
| **Service Logic** | ğŸ”´ **Pending** | éœ€ä» `gin` Handler ä¸­å‰¥ç¦»ä¸šåŠ¡é€»è¾‘ã€‚ |

### 1.2 CLI Transformation (CLI æ”¹é€ ) - "The Interface"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Cobra Entry** | ğŸ”´ **Pending** | `main.go` éœ€é‡å†™ã€‚ |
| **Server Command** | ğŸ”´ **Pending** | ä¿æŒé»˜è®¤è¡Œä¸ºçš„å…¼å®¹æ€§å°è£…ã€‚ |
| **Scan Command** | ğŸ”´ **Pending** | ç‹¬ç«‹çš„å•æœºæ‰«æå…¥å£ã€‚ |
| **Reporter** | ğŸ”´ **Pending** | æ§åˆ¶å°è¾“å‡ºæ ¼å¼åŒ– (ConsoleReporter)ã€‚ |

### 1.3 Native Capabilities (åŸç”Ÿèƒ½åŠ›) - "The Power"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Concurrency** | ğŸ”´ **Pending** | åŸºäº Semaphore çš„ `Runner` å®ç°ã€‚ |
| **Host Discovery** | ğŸ”´ **Pending** | åŸç”Ÿ ICMP/ARP Pingã€‚ |
| **Port Scan** | ğŸ”´ **Pending** | åŸç”Ÿ TCP SYN/Connect Scanã€‚ |
| **Web Finger** | ğŸ”´ **Pending** | åŸºäº `httpx` æˆ–åŸç”Ÿ HTTP åº“çš„æŒ‡çº¹è¯†åˆ«ã€‚ |

### 1.4 Cluster Integration (é›†ç¾¤é›†æˆ) - "The Connection"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Join Protocol** | ğŸ”´ **Pending** | Token + CA Hash æ¡æ‰‹é€»è¾‘ã€‚ |
| **Auth Storage** | ğŸ”´ **Pending** | å‡­è¯çš„å®‰å…¨æŒä¹…åŒ–ã€‚ |
| **Task Pulling** | ğŸŸ¡ **Legacy** | æ—§ç‰ˆ HTTP è½®è¯¢é€»è¾‘å­˜åœ¨ï¼Œéœ€é€‚é…æ–° Coreã€‚ |

---

## 2. ä¸‹ä¸€æ­¥è¡ŒåŠ¨ (Next Steps)

**"Stop designing. Start coding."**

### P0: Phase 1 - æ ¸å¿ƒè§£è€¦ (Core Decoupling)
*   **ç›®æ ‡**: å»ºç«‹ `internal/core`ï¼Œå®šä¹‰ `Task` æ¨¡å‹ã€‚
*   **è¡ŒåŠ¨**:
    1.  åˆ›å»º `internal/core` ç›®å½•ã€‚
    2.  å®šä¹‰ `internal/core/model/task.go`ã€‚
    3.  å®šä¹‰ `Scanner` æ¥å£ã€‚

### P1: Phase 2 - CLI éª¨æ¶ (CLI Skeleton)
*   **ç›®æ ‡**: å¼•å…¥ Cobraï¼Œè®©ç¨‹åºè·‘èµ·æ¥ã€‚
*   **è¡ŒåŠ¨**:
    1.  å¼•å…¥ `spf13/cobra`ã€‚
    2.  é‡æ„ `cmd/agent/main.go`ã€‚
    3.  å®ç° `version` å’Œ `server` (ç©ºå£³) å‘½ä»¤ã€‚

---

## 3. é£é™©ä¸é˜»ç¢ (Risks & Blockers)

*   **é£é™©**: è¿‡åº¦è®¾è®¡ã€‚ä¸è¦ä¸€å¼€å§‹å°±è¯•å›¾å®ç°å®Œç¾çš„æ‰«æå™¨ã€‚å…ˆè·‘é€š "Ping" å’Œ "Port Scan" å³å¯ã€‚
*   **é˜»ç¢**: æ— ã€‚æ–‡æ¡£å·²é½å¤‡ï¼Œåªå·®ä»£ç ã€‚

---

**Linus's Verdict (å½“å‰è£å†³)**:

æ–‡æ¡£å¾ˆæ¼‚äº®ï¼Œä½†**ä»£ç åº“æ˜¯ç©ºçš„**ï¼ˆç›¸å¯¹äºæ–°æ¶æ„è€Œè¨€ï¼‰ã€‚
æˆ‘ä»¬ç°åœ¨çš„é¦–è¦ä»»åŠ¡ä¸æ˜¯å†™æ›´å¤šçš„æ–‡æ¡£ï¼Œè€Œæ˜¯**å†™ä»£ç **ã€‚
ç«‹å³å¯åŠ¨ **Phase 1: æ ¸å¿ƒè§£è€¦**ã€‚
