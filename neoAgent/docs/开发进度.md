# Agent å¼€å‘è¿›åº¦è¯„ä¼° (æˆªè‡³ 2026-01-26)

## æ ¸å¿ƒçŠ¶æ€æ¦‚è§ˆ

**"Foundation First. Speed Second."**
Agent æ­£å¤„äºä» "HTTP Worker" å‘ "Native Scanner" çš„å…³é”®è½¬å‹æœŸã€‚
Cobra CLI æ¶æ„å’Œ Core Task æ¨¡å‹å·²å»ºç«‹ï¼ŒOptions å¼ºç±»å‹å‚æ•°è§£æå·²å°±ç»ªã€‚
**Phase 3 (åŸç”Ÿèƒ½åŠ›å»ºè®¾)** å·²åŸºæœ¬å®Œæˆï¼Œå…¨é¢è¿›å…¥ **Phase 4 (ç¼–æ’ä¸é›†æˆ)**ã€‚

*   **Architecture (æ¶æ„)**: **90%**ã€‚Cobra å‘½ä»¤æ ‘ã€Options æ¨¡å¼ã€Core Task æ¨¡å‹å·²å®Œæˆï¼ŒReporter æ¥å£å·²å®šä¹‰ã€‚
*   **Core Capability (æ ¸å¿ƒèƒ½åŠ›)**: **90%**ã€‚
    *   IpAliveScanner: ğŸŸ¢ (RTT/TTL/OS/Hostname)
    *   PortScanner: ğŸŸ¢ (TCP Connect)
    *   ServiceScanner: ğŸŸ¢ (Nmap Engine + Custom Rules)
    *   OSScanner: ğŸŸ¢ (TCP/IP Stack Fingerprint + Service Banner)
*   **Infrastructure (åŸºç¡€è®¾æ–½)**: **90%**ã€‚Nmap è§„åˆ™åº“é™æ€æ‰“åŒ…å®Œæˆï¼Œç½‘ç»œåº“ (Dialer/Proxy) é‡æ„å®Œæˆï¼ŒRaw Socket æ”¯æŒå°±ç»ªã€‚
*   **Connectivity (è¿æ¥æ€§)**: **50%**ã€‚`server` å‘½ä»¤å·²æ”¯æŒ Token å‚æ•°ï¼Œä½†ä¸ Master çš„å®é™…é€šä¿¡é€»è¾‘éœ€é€‚é…æ–°æ¶æ„ã€‚

---

## 1. æ¨¡å—è¯¦ç»†è¯„ä¼°

### 1.1 Core Decoupling (æ ¸å¿ƒè§£è€¦) - "The Foundation"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Directory Structure** | ğŸŸ¢ **Done** | `internal/core` å·²åˆ›å»ºã€‚ |
| **Task Model** | ğŸŸ¢ **Done** | `model.Task` å·²å®šä¹‰ï¼Œæ”¯æŒå¤šç§æ‰«æç±»å‹ã€‚ |
| **Service Logic** | ğŸŸ¢ **Done** | Scanner/Runner æ¥å£å·²å®šä¹‰ (`runner/interface.go`)ã€‚ |
| **Reporter** | ğŸŸ¢ **Done** | `ConsoleReporter` å·²å®ç°ï¼Œæ”¯æŒ Tabular è¾“å‡ºã€‚ |

### 1.2 CLI Transformation (CLI æ”¹é€ ) - "The Interface"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Cobra Entry** | ğŸŸ¢ **Done** | `main.go` å·²é‡å†™ï¼Œ`root.go` é›†æˆ Viperã€‚ |
| **Server Command** | ğŸŸ¢ **Done** | æ”¯æŒ `--master` å’Œ `--token` å‚æ•°ã€‚ |
| **Scan Command** | ğŸŸ¢ **Done** | 8ç§æ‰«æå­å‘½ä»¤ (Alive, Port, Service, OS, Web, Dir, Vuln, Subdomain) å·²å°±ç»ªã€‚ |
| **Proxy Command** | ğŸŸ¢ **Done** | æ”¯æŒ Socks5/HTTP/PortForward æ¨¡å¼å‚æ•°è§£æã€‚ |
| **Output Config** | ğŸŸ¢ **Done** | å…¨å±€æ”¯æŒ CSV/JSON è¾“å‡º (`--oc`, `--oj`)ã€‚ |

### 1.3 Native Capabilities (åŸç”Ÿèƒ½åŠ›) - "The Power"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Concurrency** | ğŸŸ¢ **Done** | åŸºäº Semaphore çš„å¹¶å‘æ§åˆ¶ï¼Œæ”¯æŒ WaitGroup è°ƒåº¦ã€‚ |
| **Host Discovery** | ğŸŸ¢ **Done** | `IpAliveScanner` å·²å®ç° ARP/ICMP/TCP æ¢æµ‹ï¼Œæ”¯æŒ OS/Hostname/RTT/TTL è§£æã€‚ |
| **Port Scan** | ğŸŸ¢ **Done** | åŸç”Ÿ TCP Connect Scanï¼Œæ”¯æŒå¹¶å‘æ§åˆ¶ã€‚ |
| **Service Scan** | ğŸŸ¢ **Done** | `NmapEngine` ç§»æ¤å®Œæˆï¼Œæ”¯æŒå®˜æ–¹/è‡ªå®šä¹‰è§„åˆ™æ··åˆåŠ è½½ã€‚ |
| **OS Finger** | ğŸŸ¢ **Done** | å®ç°äº† Nmap TCP/IP æ ˆæŒ‡çº¹è¯†åˆ« (Loopback ä¼˜åŒ–) + æœåŠ¡ Banner è¾…åŠ©è¯†åˆ«ã€‚ |
| **Web Finger** | ğŸ”´ **Pending** | åŸºäº `httpx` æˆ–åŸç”Ÿ HTTP åº“çš„æŒ‡çº¹è¯†åˆ«ã€‚ |

### 1.4 Cluster Integration (é›†ç¾¤é›†æˆ) - "The Connection"
| ç»„ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
| :--- | :--- | :--- |
| **Join Protocol** | ğŸŸ¢ **Done** | CLI å‚æ•°å·²æ”¯æŒ Tokenï¼ŒåºŸé™¤ç‹¬ç«‹çš„ Join å‘½ä»¤ã€‚ |
| **Auth Storage** | ğŸŸ¡ **Partial** | Viper å·²ç»‘å®š Tokenï¼Œéœ€ç¡®ä¿æŒä¹…åŒ–ã€‚ |
| **Task Pulling** | ğŸŸ¡ **Legacy** | æ—§ç‰ˆ HTTP è½®è¯¢é€»è¾‘å­˜åœ¨ï¼Œéœ€é€‚é…æ–° Coreã€‚ |

---

## 2. ä¸‹ä¸€æ­¥è¡ŒåŠ¨ (Next Steps)

**"Stop designing. Start coding."**

### P0: Phase 4.1 - å…¨æµç¨‹ç¼–æ’ (Scan Run)
*   **ç›®æ ‡**: å®ç° `neoAgent scan run`ï¼Œè®© Agent èƒ½è‡ªåŠ¨ä¸²è”æ‰§è¡Œä»»åŠ¡ã€‚
*   **è¡ŒåŠ¨**:
    1.  å®ç° `internal/core/pipeline` æ¡†æ¶ï¼Œæ”¯æŒ Task é—´çš„æ•°æ®æµè½¬ (e.g. Alive IPs -> Port Scan)ã€‚
    2.  å®ç° `cmd/agent/scan/run.go` CLI å…¥å£ã€‚
    3.  å®šä¹‰ Pipeline é…ç½®ç»“æ„ (YAML/JSON) æˆ–ç¡¬ç¼–ç é»˜è®¤ç­–ç•¥ã€‚

### P1: Phase 4.2 - é›†ç¾¤é€‚é… (Cluster Adapter)
*   **ç›®æ ‡**: è®© `neoAgent server` ä½¿ç”¨æ–°çš„ Runnerã€‚
*   **è¡ŒåŠ¨**:
    1.  é‡æ„ `server` å¾ªç¯ï¼Œä½¿å…¶ä» Master æ‹‰å– Task å¹¶è½¬æ¢ä¸º `model.Task`ã€‚
    2.  è°ƒç”¨ `Runner` (æˆ– Pipeline) æ‰§è¡Œä»»åŠ¡ã€‚
    3.  å®ç°ç»“æœå›ä¼ é€‚é…å™¨ã€‚

### P2: Phase 3.6 - é«˜çº§å¹¶å‘ä¼˜åŒ– (Continued)
*   **ç›®æ ‡**: è¿›ä¸€æ­¥å‹æ¦¨æ€§èƒ½ã€‚
*   **è¡ŒåŠ¨**:
    1.  ä¼˜åŒ– `Runner` æ¥å£ï¼Œæ”¯æŒåŠ¨æ€å¹¶å‘è°ƒæ•´ (Adaptive Rate Limiting)ã€‚
    2.  å¼•å…¥ `RttEstimator` åŠ¨æ€è°ƒæ•´è¶…æ—¶æ—¶é—´ã€‚

---

## 3. é£é™©ä¸é˜»ç¢ (Risks & Blockers)

*   **é£é™©**: Pipeline çš„å¤æ‚æ€§ã€‚å¦‚ä½•ä¼˜é›…åœ°å¤„ç†ä¸åŒ Scanner ä¹‹é—´çš„è¾“å…¥è¾“å‡ºåŒ¹é…ï¼ˆä¾‹å¦‚ PortScanner è¾“å‡º `[]PortResult`ï¼ŒServiceScanner è¾“å…¥ `[]HostPort`ï¼‰ã€‚
*   **é˜»ç¢**: æ— ã€‚

---

**Linus's Verdict (å½“å‰è£å†³)**:

Phase 3 æˆ˜å½¹å¤§è·å…¨èƒœã€‚æˆ‘ä»¬å·²ç»æ‹¥æœ‰äº†å¼ºå¤§çš„å•å…µä½œæˆ˜èƒ½åŠ›ï¼ˆScannerï¼‰ã€‚
ç°åœ¨çš„ä»»åŠ¡æ˜¯æŒ‡æŒ¥è¿™äº›å•å…µååŒä½œæˆ˜ã€‚
ç«‹å³å¯åŠ¨ **Phase 4: å…¨æµç¨‹ç¼–æ’**ã€‚
