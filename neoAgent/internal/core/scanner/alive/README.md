# IP Alive Scanner 参数说明

本文档详细说明了 `neoAgent scan alive` 命令的参数逻辑和使用场景。

## 核心模式

IpAliveScanner 根据用户输入的参数，自动在以下两种模式间切换：

### 1. 自动模式 (Auto Mode)
- **触发条件**：不使用任何协议开关参数（即不加 `--arp`, `--icmp`, `--tcp`）。
- **行为逻辑**：
  - **智能判断**：程序会自动判断目标 IP 是否在本地局域网（同广播域）。
  - **局域网策略**：并发执行 **ARP + ICMP**。
    - 优先使用 ARP（速度极快），通常先返回结果。
    - **注意**：ARP 结果不包含 TTL，因此无法识别 OS。
  - **广域网策略**：并发执行 **ICMP + TCP**。
    - TCP 使用默认端口（22, 23, 80, 443 等）进行握手探测。
- **适用场景**：快速探测存活主机，不关心 OS/TTL 信息。

### 2. 手动模式 (Manual Mode)
- **触发条件**：使用了任意一个协议开关参数。
- **行为逻辑**：程序完全听从指令，**只执行**用户指定的协议。
  - `--arp`：仅执行 ARP 探测。
    - 仅限局域网有效（如果非同网段,arp探测包仍会发包但是不会返回结果）。
    - 速度快，无 TTL/OS 信息。
  - `--icmp`：仅执行 ICMP Ping 探测。
    - 调用系统 `ping` 命令。
    - **唯一能获取 OS/TTL 的方式**。
    - 速度受限于 Ping 命令执行时间。
  - `--tcp`：仅执行 TCP 全连接探测。
    - 需配合 `--tcp-ports` 指定端口（默认使用内置常用端口列表）。
    - 无 TTL/OS 信息。
  - **组合使用**：可以同时开启多个（例如 `--icmp --tcp`），它们会并发执行，且遵循“速度优先”原则（谁先成功就返回谁的结果）。

## 参数详细说明

| 参数 (Flag) | 作用描述 | 触发模式 | 备注 |
| :--- | :--- | :--- | :--- |
| **`-t, --target`** | **[必选]** 扫描目标 | - | 支持单IP (192.168.1.1) 或 CIDR (192.168.1.0/24) |
| **`-c, --concurrency`** | **[可选]** 并发线程数 | 全局有效 | 默认 `1000`。控制同时探测的 IP 数量。 |
| **`--resolve-hostname`** | **[可选]** 反向域名解析 | 全局有效 | 开启后尝试通过 DNS PTR 记录解析主机名。默认关闭。 |
| **`--arp`** | 启用 ARP 探测 | **Manual** | 仅二层探测，极快，无 TTL。仅对同网段有效。 |
| **`--icmp`** | 启用 ICMP 探测 | **Manual** | 调用系统 Ping。**唯一能获取 OS/TTL 的方式**。 |
| **`--tcp`** | 启用 TCP 探测 | **Manual** | 进行 TCP 三次握手。需配合 `--tcp-ports`。 |
| **`--tcp-ports`** | 指定 TCP 探测端口 | 全局有效 | 默认 `22,23,80...`。在 Auto 模式下用于广域网探测，Manual 模式下配合 `--tcp` 使用。 |

## 常见使用场景

### 场景 1: 极速存活探测 (默认推荐)
> "我就想看看哪些 IP 活着，越快越好，不需要 OS 信息。"

```powershell
neoAgent scan alive -t 192.168.1.0/24
```
*(使用默认 Auto 模式，局域网内优先 ARP，速度最快)*

### 场景 2: 获取操作系统信息
> "我想知道存活主机的操作系统类型 (Windows/Linux)。"

```powershell
neoAgent scan alive -t 192.168.1.0/24 --icmp
```
*(强制使用 ICMP，牺牲一点速度换取 TTL/OS 信息)*

### 场景 3: 穿透防火墙探测
> "目标防火墙禁用了 Ping，我想用 TCP 80 端口探测。"

```powershell
neoAgent scan alive -t 10.0.0.1/24 --tcp --tcp-ports 80
```
*(强制使用 TCP 探测)*

### 场景 4: 综合探测 (高级)
> "我想用 ICMP 和 TCP 同时探测，谁通了都行。"

```powershell
neoAgent scan alive -t 10.0.0.1/24 --icmp --tcp
```
*(并发执行 ICMP 和 TCP)*
