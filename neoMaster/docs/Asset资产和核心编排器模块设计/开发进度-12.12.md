# 开发进度评估 (截至 2026-01-15)

## 核心状态概览

**"Code is data. Data is code."**
目前系统核心架构已稳定，ETL 数据流转闭环已打通。我们没有引入不必要的复杂性，所有组件都保持了单一职责。

*   **Control Plane (控制面)**: **95%**。调度器 (Orchestrator) 已经像瑞士钟表一样精密运转。DAG 依赖解析、策略拦截、任务分发全部就绪。
*   **Data Plane (数据面)**: **90%**。ETL 管道已打通。Mapper 覆盖了核心业务（IP/Port/Finger/Vuln/Web），对于尚未定义清晰 Schema 的边缘数据（Proxy/Directory），我们选择**显式跳过 (Explicit Skip)**，而不是把数据库变成垃圾场。
*   **Security (安全面)**: **85%**。规则管理 (RuleManager) 的 I/O 基础设施已完成，支持原子更新和 SHA256 完整性校验。

---

## 1. 模块详细评估

### 1.1 Orchestrator (编排器) - "The Brain"
| 组件 | 状态 | 备注 |
| :--- | :--- | :--- |
| **ScheduleManager** | ✅ **Done** | Cron 定时触发正常。 |
| **TransitionEngine** | ✅ **Done** | **真正的 DAG 并行**。移除全局 Barrier 是正确的决定，系统吞吐量不再受限于最慢的节点。 |
| **TaskDispatcher** | ✅ **Done** | Pull 模式 + CAS 防抢占。简单，有效。 |

### 1.2 Policy Enforcer (策略执行器) - "The Gatekeeper"
| 组件 | 状态 | 备注 |
| :--- | :--- | :--- |
| **Scope/Whitelist** | ✅ **Done** | 严防越权扫描。 |
| **SkipLogic** | ✅ **Done** | 动态跳过规则已就绪。 |

### 1.3 Asset ETL Engine (资产清洗) - "The Pipeline"
| 组件 | 状态 | 备注 |
| :--- | :--- | :--- |
| **Processor** | ✅ **Done** | 协程池 + DLQ (死信队列)。数据不再静默丢失，要么入库，要么进死信。 |
| **Mapper** | ✅ **Done** | **覆盖核心**: `ip`, `port`, `finger`, `vuln`, `web`, `poc`, `password`. <br> **显式跳过**: `proxy`, `directory`, `subdomain`, `api`, `file`. (Don't map what you can't store). |
| **Merger** | ✅ **Done** | Host/Service/Web/Vuln 关联逻辑已闭环。ID 集合去重逻辑修复了数据覆盖 bug。 |

### 1.4 Fingerprint & Enrichment (指纹与丰富化)
| 组件 | 状态 | 备注 |
| :--- | :--- | :--- |
| **RuleManager** | ✅ **Done** | I/O 标准化完成。支持原子写入、备份和 SHA256 校验。 |
| **Matcher Logic** | ✅ **Done** | `FingerprintMatcher` 已实现，支持从 Service 表提取数据重跑指纹。 |
| **Cron Integration** | 🔴 **Pending** | **关键缺失**。逻辑写好了，但没人调用它。它现在是一堆躺在磁盘上的死代码。 |

---

## 2. 下一步计划 (The Plan)

**"Talk is cheap. Show me the code."**

### P0: 激活指纹治理 (Activate the Governance)
*   **问题**: `FingerprintMatcher` 逻辑完备，但没有接入 Cron。
*   **行动**:
    1.  在 `cmd/master` 或 `scheduler` 中注册 Cron 任务。
    2.  调用 `FingerprintMatcher.ProcessBatch`。
    3.  **验证**: 确保它在后台静默运行，不阻塞主线程。

### P1: 完善工具适配层 (Tool Adapter)
*   **问题**: Master 端逻辑很强，但 Agent 端需要能够完美执行命令并解析输出。
*   **行动**:
    1.  完善 Agent 端的 `CommandFactory`。
    2.  确保 `OutputNormalizer` 能处理工具的各种奇葩输出格式。

### P2: 边缘数据决策 (Decision on Edge Data)
*   **问题**: Proxy, Directory, Subdomain 目前被显式跳过。
*   **行动**:
    *   **决策**: 我们真的需要存这些数据吗？
    *   如果需要，设计专用表结构（Schema First）。
    *   如果不需要，保持现状。**不要为了"功能全"而存垃圾数据。**

---

**Linus's Note**:
代码质量总体尚可。ETL 的错误处理机制 (DLQ) 是个亮点。但是，**未被调用的代码就是死代码**，立刻把 Cron Job 加上。
