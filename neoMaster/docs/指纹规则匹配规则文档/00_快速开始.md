# 指纹规则快速开始指南

欢迎使用 NeoScan 指纹识别系统！本指南将帮助您在 5 分钟内了解如何编写自己的指纹规则。

## 什么是指纹规则？

指纹规则是一种用于识别 Web 应用、服务、CMS 等资产的匹配模式。通过定义特定的特征（如页面标题、HTTP 响应头、响应内容等），系统可以自动识别目标是什么应用。

## 最简单的指纹规则示例

```json
{
  "name": "WordPress",
  "title": "Log In"
}
```

这个规则的意思是：如果网页标题包含 "Log In"，就识别为 WordPress。

## 指纹匹配的基本原理

NeoScan 的指纹匹配系统采用**声明式规则**设计：

1. **你只需要定义"要识别什么"** - 比如 "WordPress 的登录页标题是 Log In"
2. **系统自动决定"怎么识别"** - 系统会自动提取网页标题，检查是否包含指定内容

### 匹配流程

```
1. 扫描器访问目标网站
   ↓
2. 获取 HTTP 响应（状态码、响应头、页面内容）
   ↓
3. 系统自动提取特征（标题、所有响应头、页面内容等）
   ↓
4. 与所有指纹规则进行匹配
   ↓
5. 如果匹配成功，返回识别结果
```

## 两种规则编写方式

### 方式1：简单字段（推荐新手使用）

```json
{
  "name": "WordPress",
  "status_code": "200",
  "title": "Log In"
}
```

**优点**：
- 简单直观，易于理解
- 不需要了解复杂的语法
- 适合常见的简单匹配

**适用场景**：
- 只需要匹配标题、状态码等简单特征
- 刚开始学习指纹规则编写

### 方式2：match 字段（推荐高级用户使用）

```json
{
  "name": "WordPress",
  "match": {
    "and": [
      {"field": "status_code", "operator": "equals", "value": "200"},
      {"field": "title", "operator": "contains", "value": "Log In"}
    ]
  }
}
```

**优点**：
- 完全灵活，支持所有操作符
- 支持复杂的逻辑组合（AND/OR）
- 支持高级操作符（正则、数值比较等）

**适用场景**：
- 需要复杂的匹配逻辑
- 需要使用高级操作符

## 常用字段快速参考

| 字段名 | 说明 | 示例 |
|-------|------|------|
| `name` | 指纹名称（必填） | "WordPress" |
| `status_code` | HTTP 状态码 | "200" |
| `title` | 网页标题 | "Log In" |
| `header` | HTTP 响应头 | "nginx" |
| `server` | Server 响应头 | "Apache" |
| `body` | 响应体内容 | "WordPress" |
| `match` | 高级匹配规则 | 见下方 |

## match 字段快速参考

match 字段支持两种格式：

### 格式1：正则表达式

```json
{
  "name": "WordPress",
  "match": "wp-.*"
}
```

### 格式2：JSON 规则

```json
{
  "name": "WordPress",
  "match": {
    "field": "title",
    "operator": "contains",
    "value": "Log In"
  }
}
```

## 下一步

- 📖 [指纹匹配原理详解](./01_指纹匹配原理.md) - 深入了解指纹匹配的工作机制
- ✍️ [简单规则编写指南](./02_简单规则编写.md) - 学习如何编写简单的指纹规则
- 🚀 [高级规则编写指南](./03_高级规则编写.md) - 学习如何使用 match 字段编写高级规则
- 📚 [规则字段详解](./04_规则字段详解.md) - 查看所有可用字段的详细说明
- 💡 [常见示例](./05_常见示例.md) - 查看常见应用的指纹规则示例
- ✨ [最佳实践](./06_最佳实践.md) - 学习编写高质量规则的最佳实践

## 常见问题

### Q: 指纹规则保存在哪里？

A: 指纹规则可以保存在两个地方：
1. **数据库**：`asset_finger` 表，通过 Web 界面管理
2. **JSON 文件**：`rules/fingerprint/` 目录，系统启动时自动加载

### Q: 如何测试我编写的指纹规则？

A: 您可以通过以下方式测试：
1. 使用系统的指纹识别 API 进行测试
2. 在 Web 界面中手动触发指纹识别
3. 查看日志输出，了解匹配过程

### Q: 规则不生效怎么办？

A: 请检查：
1. 规则是否启用（`enabled` 字段为 `true`）
2. 匹配条件是否正确
3. 是否有其他规则优先匹配
4. 查看日志了解匹配失败原因

### Q: 可以同时使用简单字段和 match 字段吗？

A: 可以！这是最佳实践：
```json
{
  "name": "WordPress",
  "status_code": "200",        // 简单字段
  "title": "Log In",            // 简单字段
  "match": "wp-.*"              // match 字段（正则）
}
```

## 获取帮助

如果您在编写指纹规则时遇到问题，请：
1. 查看本文档的其他章节
2. 查看系统日志了解匹配过程
3. 参考常见示例章节
4. 联系技术支持

祝您使用愉快！
